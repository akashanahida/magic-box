# å·¥ä½œæµç¨‹çš„åç§°ï¼Œå°†æ˜¾ç¤ºåœ¨ GitHub Actions é¡µé¢
name: Build Zed on Windows

# æ§åˆ¶å·¥ä½œæµç¨‹çš„è§¦å‘æ—¶æœº
on:
  # å…è®¸æ‰‹åŠ¨ä» Actions é¡µé¢è§¦å‘æ­¤å·¥ä½œæµç¨‹
  workflow_dispatch:

# å®šä¹‰å·¥ä½œæµç¨‹ä¸­çš„ä»»åŠ¡ï¼ˆjobsï¼‰
jobs:
  # å®šä¹‰ä¸€ä¸ªåä¸º "build" çš„ä»»åŠ¡
  build:
    # æŒ‡å®šä»»åŠ¡è¿è¡Œåœ¨ GitHub æ‰˜ç®¡çš„æœ€æ–°ç‰ˆ Windows è™šæ‹Ÿæœºä¸Š
    runs-on: windows-latest

    # ä»»åŠ¡çš„æ‰§è¡Œæ­¥éª¤
    steps:
      # æ­¥éª¤ 1: æ ¹æ® Zed Windows æ„å»ºæ–‡æ¡£ï¼Œå¯ç”¨é•¿è·¯å¾„æ”¯æŒä»¥é˜²æ­¢æ„å»ºå¤±è´¥
      - name: Enable long paths for Git
        run: git config --system core.longpaths true

      - name: Enable long paths for Windows
        # æ­¤å‘½ä»¤éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œåœ¨ GitHub Actions çš„ runner ä¸­é»˜è®¤æ‹¥æœ‰
        run: New-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\FileSystem" -Name "LongPathsEnabled" -Value 1 -PropertyType DWORD -Force

      # æ­¥éª¤ 2: æ£€å‡º zed-industries/zed ä»“åº“çš„ä»£ç  [<sup data-citation='{&quot;id&quot;:9,&quot;url&quot;:&quot;https://juejin.cn/post/6978436693485420575&quot;,&quot;title&quot;:&quot;06.Gitä»æ”¾å¼ƒåˆ°å…¥é—¨ï¼š å‘½ä»¤checkoutå›¾è§£&quot;,&quot;content&quot;:&quot;å‰è¨€ -- git checkout å‘½ä»¤ç”¨æ¥åˆ‡æ¢åˆ†æ”¯ï¼Œæˆ–è€…æ£€å‡ºå†…å®¹åˆ°å·¥ä½œç›®å½•ã€‚æœ¬æ–‡é€šè¿‡å›¾æ–‡ç»“åˆæ–¹å¼è®²è§£å…¶åŠŸèƒ½å’Œå·¥ä½œåŸç†ã€‚ æœ¬ç³»åˆ—æ›´å¤šæ–‡ç« è¯¦è§ä¸“æ  ğŸ“š Gitä»æ”¾å¼ƒåˆ°å…¥é—¨ ã€‚ é¡¹ç›®åˆå§‹åŒ– æ¥ä¸‹æ¥ç»“åˆä¸Šç¯‡åˆ†æ”¯é‡Œé¢çš„çŸ¥è¯†ç‚¹ï¼Œé€šè¿‡å›¾è§£çš„æ–¹å¼æ¥è¯´æ˜å‘½ä»¤è°ƒç”¨åå‘ç”Ÿäº†ä»€ä¹ˆæ“ä½œï¼ é¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ï¼Œç”¨äºåç»­ç¤ºä¾‹æ¼”ç¤ºã€‚åˆ›å»ºä¸¤ä¸ªåˆ†æ”¯ä¸€ä¸ª master å’Œ dev ã€‚é¡¹ç›®ç›®å½•ä¸‹æœ‰ä¸¤ä¸ªæ–‡ä»¶filetxtã€Readm&quot;}'>9</sup>](https://juejin.cn/post/6978436693485420575)
      # ä½¿ç”¨ `repository` å‚æ•°æŒ‡å®šè¦æ‹‰å–çš„ä»“åº“ [<sup data-citation='{&quot;id&quot;:7,&quot;url&quot;:&quot;https://zed.dev/blog/git&quot;,&quot;title&quot;:&quot;Native Git support in Zed - Zed Blog&quot;,&quot;content&quot;:&quot;Weve heard for a long time that many of you want to be able to use Git from within Zed Not necessarily for everything, but particularly for the 90 git-commit, git-push workflow, its just too slow to h&quot;}'>7</sup>](https://zed.dev/blog/git)[<sup data-citation='{&quot;id&quot;:12,&quot;url&quot;:&quot;https://github.com/zed-industries/zed&quot;,&quot;title&quot;:&quot;GitHub - zed-industries/zed: Code at the speed of thought â€“ Zed is a high-performance, multiplayer code editor from the creators of Atom and Tree-sitter.&quot;,&quot;content&quot;:&quot;Zed Welcome to Zed, a high-performance, multiplayer code editor from the creators of Atom and Tree-sitter Installation On macOS and Linux you can download Zed directly or install Zed via your local pa&quot;}'>12</sup>](https://github.com/zed-industries/zed)
      - name: Checkout zed-industries/zed repository
        uses: actions/checkout@v4
        with:
          repository: 'zed-industries/zed'

      # æ­¥éª¤ 3: å®‰è£… Rust å·¥å…·é“¾
      # è¿™ä¸ª action ä¼šè‡ªåŠ¨è¯»å–ä»“åº“ä¸­çš„ `rust-toolchain.toml` æ–‡ä»¶æ¥å®‰è£…æ­£ç¡®çš„ Rust ç‰ˆæœ¬
      - name: Install Rust toolchain
        uses: dtolnay/rust-toolchain@stable
        with:
          toolchain: stable

      # æ­¥éª¤ 4: ç¼“å­˜ Cargo ä¾èµ–é¡¹ä»¥åŠ å¿«åç»­æ„å»ºé€Ÿåº¦
      # é€šè¿‡ç¼“å­˜ï¼Œä¸å¿…æ¯æ¬¡éƒ½é‡æ–°ä¸‹è½½å’Œç¼–è¯‘æ‰€æœ‰ä¾èµ–
      - name: Cache Cargo dependencies
        uses: actions/cache@v4
        with:
          path: |
            ~/.cargo/bin/
            ~/.cargo/registry/index/
            ~/.cargo/registry/cache/
            ~/.cargo/git/db/
            target/
          key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}

      # æ­¥éª¤ 5: æ„å»ºé¡¹ç›®
      # ä½¿ç”¨ `cargo build` å‘½ä»¤è¿›è¡Œå‘å¸ƒæ¨¡å¼çš„æ„å»ºï¼Œ--verbose å‚æ•°å¯ä»¥æä¾›æ›´è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
      - name: Build Zed
        run: cargo build --release --verbose

      # æ­¥éª¤ 6: è¿è¡Œæµ‹è¯•
      # æ‰§è¡Œå·¥ä½œç©ºé—´ä¸­çš„æ‰€æœ‰æµ‹è¯•ï¼Œç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§
      - name: Run tests
        run: cargo test --workspace --release --no-fail-fast

      # æ­¥éª¤ 7: ä¸Šä¼ æ„å»ºäº§ç‰©
      # å°†ç¼–è¯‘å¥½çš„ zed.exe æ–‡ä»¶ä½œä¸ºåä¸º "zed-windows" çš„æ„ä»¶ä¸Šä¼ 
      # è¿™æ ·å°±å¯ä»¥åœ¨å·¥ä½œæµç¨‹è¿è¡Œç»“æŸåä¸‹è½½å’Œä½¿ç”¨å®ƒ
      - name: Upload Zed artifact
        uses: actions/upload-artifact@v4
        with:
          name: zed-windows
          path: target/release/zed.exe
